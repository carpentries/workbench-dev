<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.16">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Learn how to build, debug, and contribute to the components that make up The Carpentries Workbench.">

<title>Workbench Developer's Guide ‚Äì Appendix B ‚Äî Examples and Flight Rules</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./sop.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="guide.scss">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sop.html">Appendices</a></li><li class="breadcrumb-item"><a href="./flight-rules.html"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Examples and Flight Rules</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Workbench Developer‚Äôs Guide</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/carpentries/workbench-dev/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">System Setup</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Testing The Workbench</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Design Considerations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Flow Diagrams</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./features.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Adding Features</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">{sandpaper} User Interface</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sandpaper/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The {sandpaper} package</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sandpaper/testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Testing {sandpaper}</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sandpaper/global-state.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">The global state in {sandpaper}</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sandpaper/package-cache.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The R package cache</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sandpaper/building-html.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Building HTML</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">{pegboard} Validation and Parsing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pegboard/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">The {pegboard} package</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">{varnish} Web Styling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./varnish/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">The {varnish} package</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Package Distribution</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./releases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Release Process for Workbench Packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hotfixes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Releasing Hotfixes</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Remote Deployment and Management</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./remote/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./remote/deploy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Deployment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./remote/pull-request.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Pull Request Responders</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Standard Operating Procedures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./flight-rules.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Examples and Flight Rules</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-within" id="toc-sec-within" class="nav-link active" data-scroll-target="#sec-within"><span class="header-section-number">B.1</span> Within The Workbench R Packages</a>
  <ul>
  <li><a href="#sec-single" id="toc-sec-single" class="nav-link" data-scroll-target="#sec-single"><span class="header-section-number">B.1.1</span> Single Package</a>
  <ul class="collapse">
  <li><a href="#single-function-issues" id="toc-single-function-issues" class="nav-link" data-scroll-target="#single-function-issues"><span class="header-section-number">B.1.1.1</span> Single-Function Issues</a></li>
  <li><a href="#multi-function-issues" id="toc-multi-function-issues" class="nav-link" data-scroll-target="#multi-function-issues"><span class="header-section-number">B.1.1.2</span> Multi-Function Issues</a></li>
  <li><a href="#test-failures-with-no-user-impact" id="toc-test-failures-with-no-user-impact" class="nav-link" data-scroll-target="#test-failures-with-no-user-impact"><span class="header-section-number">B.1.1.3</span> Test Failures With No User Impact</a></li>
  </ul></li>
  <li><a href="#sec-across" id="toc-sec-across" class="nav-link" data-scroll-target="#sec-across"><span class="header-section-number">B.1.2</span> Aross Packages</a>
  <ul class="collapse">
  <li><a href="#order-of-operations" id="toc-order-of-operations" class="nav-link" data-scroll-target="#order-of-operations"><span class="header-section-number">B.1.2.1</span> Order of Operations</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">B.1.2.2</span> Examples</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-upstream" id="toc-sec-upstream" class="nav-link" data-scroll-target="#sec-upstream"><span class="header-section-number">B.2</span> Upstream R Packages</a>
  <ul>
  <li><a href="#sec-renv" id="toc-sec-renv" class="nav-link" data-scroll-target="#sec-renv"><span class="header-section-number">B.2.1</span> renv</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background"><span class="header-section-number">B.2.1.1</span> Background</a></li>
  <li><a href="#in-practices" id="toc-in-practices" class="nav-link" data-scroll-target="#in-practices"><span class="header-section-number">B.2.1.2</span> In practices</a></li>
  <li><a href="#debugging-tips" id="toc-debugging-tips" class="nav-link" data-scroll-target="#debugging-tips"><span class="header-section-number">B.2.1.3</span> Debugging Tips</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-actions" id="toc-sec-actions" class="nav-link" data-scroll-target="#sec-actions"><span class="header-section-number">B.3</span> GitHub Actions</a>
  <ul>
  <li><a href="#networking-failures" id="toc-networking-failures" class="nav-link" data-scroll-target="#networking-failures"><span class="header-section-number">B.3.1</span> Networking Failures</a></li>
  <li><a href="#upstream-system-dependency-issues" id="toc-upstream-system-dependency-issues" class="nav-link" data-scroll-target="#upstream-system-dependency-issues"><span class="header-section-number">B.3.2</span> Upstream System Dependency Issues</a>
  <ul class="collapse">
  <li><a href="#sec-bioc-intro109" id="toc-sec-bioc-intro109" class="nav-link" data-scroll-target="#sec-bioc-intro109">SSL error</a></li>
  </ul></li>
  <li><a href="#workflow-mis-configuration" id="toc-workflow-mis-configuration" class="nav-link" data-scroll-target="#workflow-mis-configuration"><span class="header-section-number">B.3.3</span> Workflow Mis-Configuration</a>
  <ul class="collapse">
  <li><a href="#s399" id="toc-s399" class="nav-link" data-scroll-target="#s399">files with spaces in names cause <code>pr-comment.yaml</code> workflow to fail</a></li>
  </ul></li>
  <li><a href="#permissions-changes" id="toc-permissions-changes" class="nav-link" data-scroll-target="#permissions-changes"><span class="header-section-number">B.3.4</span> Permissions Changes</a>
  <ul class="collapse">
  <li><a href="#carpentries-bot" id="toc-carpentries-bot" class="nav-link" data-scroll-target="#carpentries-bot"><span class="header-section-number">B.3.4.1</span> carpentries-bot</a></li>
  </ul></li>
  <li><a href="#actions" id="toc-actions" class="nav-link" data-scroll-target="#actions"><span class="header-section-number">B.3.5</span> Actions</a></li>
  </ul></li>
  <li><a href="#sec-structural" id="toc-sec-structural" class="nav-link" data-scroll-target="#sec-structural"><span class="header-section-number">B.4</span> Structural Features</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sop.html">Appendices</a></li><li class="breadcrumb-item"><a href="./flight-rules.html"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Examples and Flight Rules</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Appendix B ‚Äî Examples and Flight Rules</h1>
<p class="subtitle lead">aka: what to do when something‚Äôs not working</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!---

##### Issue Report Template

Replace {pkg} with the first letter of the package the issue occurs in and
{num} with the issue number

###### {pkg}{num} Situation {.unnumbered}

 - Issue: [carpentries/{pkg}#{num}](https://github.com/carpentries/{pkg}/issues/num)
 - Resolver: zkamvar
 - Type: Local
 - OS: Rocky Linux 8.8
 - Package: {pkg}

###### {pkg}{num} Diagnosis {.unnumbered}

###### {pkg}{num} Solution {.unnumbered}

###### {pkg}{num} Alternative Solution {.unnumbered}

###### {pkg}{num} Narrative {.unnumbered}

--->
<p>This part of the developers manual is a living document and serves as a window into the mind of a Workbench Maintainer as they address issues and new feature requests.</p>
<p>The following sections of this appendix will not distinguish between bugs and features, because often the process for fixing bugs is not sufficiently different than that of adding a new feature (though there are exceptions, which I will highlight below). Rather, a more logical division is to distinguish between if the issue is within The Workbench Packages, In an Upstream dependency, with GitHub Actions, and finally, issues that are more structural in nature and require more extensive user experience (UX) testing.</p>
<section id="sec-within" class="level2" data-number="B.1">
<h2 data-number="B.1" class="anchored" data-anchor-id="sec-within"><span class="header-section-number">B.1</span> Within The Workbench R Packages</h2>
<p>Bugs or features in this category are entirely within our control and are theoretically the easiest/most quick implementations. Items in this category can be split into either single package items which can be fixed with a single pull request or cross-package items, which require coordination of pull requests to achieve.</p>
<section id="sec-single" class="level3" data-number="B.1.1">
<h3 data-number="B.1.1" class="anchored" data-anchor-id="sec-single"><span class="header-section-number">B.1.1</span> Single Package</h3>
<p>In this section, we outline issues that are addressed within a single package. Note that this does not indicate that these issues are straightforward to address.</p>
<section id="single-function-issues" class="level4" data-number="B.1.1.1">
<h4 data-number="B.1.1.1" class="anchored" data-anchor-id="single-function-issues"><span class="header-section-number">B.1.1.1</span> Single-Function Issues</h4>
<p>If you are here, you have determined that the bug or feature that you are working on will affect a single function or data pathway. These issues are often the most straightforward to address. Below, I‚Äôve documented narratives for these issues.</p>
<section id="markdown-file-for-404-page-created-with-read-only-permissions" class="level5 unnumbered">
<h5 class="unnumbered anchored" data-anchor-id="markdown-file-for-404-page-created-with-read-only-permissions">Markdown file for 404 page created with read-only permissions</h5>
<section id="s479-situation" class="level6 unnumbered">
<h6 class="unnumbered anchored" data-anchor-id="s479-situation">s479 Situation</h6>
<ul>
<li>Issue: <a href="https://github.com/carpentries/sandpaper/issues/479">carpentries/sandpaper#479</a></li>
<li>Resolver: zkamvar</li>
<li>Type: Local</li>
<li>OS: Rocky Linux 8.8</li>
<li>Package: sandpaper</li>
</ul>
<p>The user is attempting to build a lesson, but they are unable to because an error appears during the ‚ÄúCreate 404 page‚Äù step:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>‚îÄ‚îÄ Creating <span class="dv">404</span> page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">file</span>(file, <span class="fu">ifelse</span>(append, <span class="st">"a"</span>, <span class="st">"w"</span>)) <span class="sc">:</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  cannot open the connection</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>In addition<span class="sc">:</span> Warning messages<span class="sc">:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>[snip]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span><span class="sc">:</span> In <span class="fu">file</span>(file, <span class="fu">ifelse</span>(append, <span class="st">"a"</span>, <span class="st">"w"</span>)) <span class="sc">:</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  cannot open file <span class="st">'/tmp/RtmpmaiZ5B/file73cdc48b90540.md'</span><span class="sc">:</span> Permission denied</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="s479-diagnosis" class="level6 unnumbered">
<h6 class="unnumbered anchored" data-anchor-id="s479-diagnosis">s479 Diagnosis</h6>
<p>This permissions issue was a problem with copying a read-only file without adjusting the subsequent permissions. It stemmed from <a href="https://github.com/carpentries/sandpaper/blob/cde890790d509c5c92c539d0adf69a6672354094/R/build_404.R#L12-L13"><code>build_404()</code></a> calling <a href="https://github.com/carpentries/sandpaper/blob/055824fbf643bd7e363b56228deffc98632aaeba/R/render_html.R#L48-L56"><code>render_html()</code></a> with the presence of a <code>links.md</code> document at the top of the lesson. Packages in the user‚Äôs R library are installed by the systems administrator and the user does not have permissions to write or append any file in that folder. When <code>build_404()</code> runs, it passes a template markdown file to <code>render_html()</code>. If there is an option called <code>sandpaper.links</code> set to a filepath, then this function will copy the input file to a temporary file and append the links to that temporary file before rendering it to HTML. Because the input file was read-only, copying the file to the temporary directory retained its permissions and we were unable to append the links.</p>
</section>
<section id="s479-solution" class="level6 unnumbered">
<h6 class="unnumbered anchored" data-anchor-id="s479-solution">s479 Solution</h6>
<p>Pull Request: <a href="https://github.com/carpentries/sandpaper/pull/482">carpentries/sandpaper#482</a></p>
<p>The solution was to add a single line adding user write permissions before the links file was appended: <code>fs::file_chmod(tmpin, "u+w")</code>.</p>
</section>
<section id="s479-alternative-solution" class="level6 unnumbered">
<h6 class="unnumbered anchored" data-anchor-id="s479-alternative-solution">s479 Alternative Solution</h6>
<p>This additionally could have been avoided by temporarily unsetting the <code>sandpaper.links</code> option for the <code>build_404()</code> function before it calls <code>render_html()</code>. This would prevent it entering the loop where it appends the links, making the process <em>slightly</em> faster. The only downside is that we would need to do that for all of the other templated pages (though I believe that might be the only one).</p>
</section>
<section id="s479-narrative" class="level6 unnumbered">
<h6 class="unnumbered anchored" data-anchor-id="s479-narrative">s479 Narrative</h6>
<ul>
<li><p>Issue: <a href="https://github.com/carpentries/sandpaper/issues/479">carpentries/sandpaper#479</a></p></li>
<li><p>First impression: this is running on a version of Linux that Zhian does not know anything about. My thoughts are that it will be a difficult fix.</p></li>
<li><p>I suspect the bug might be due to the {fs} package and ask for the user if they could test out the following code snippet:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> fs<span class="sc">::</span><span class="fu">file_temp</span>(<span class="at">ext =</span> <span class="st">".md"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"test</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">file =</span> tmp, <span class="at">append =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">readLines</span>(tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>I looked again did not recognise the code snippet where the issue seemed to be (<code>file(file, ifelse(append, 'a', 'w'))</code>) - so this seems to be a problem with a non-Workbench package.</p></li>
<li><p>initially went looking for this code in the <code>fs</code> package, but GitHub search showed that this code doesn‚Äôt appear there either.</p></li>
<li><p>next guess is the <code>cat</code> function, which is used to add link references to the end of files. I searched the R code base and <a href="https://github.com/wch/r-source/blob/cd31f24ae0046784465e0fc938d53a2cd8a7d3a4/src/library/base/R/cat.R#L28">found the snippet in the <code>cat()</code>function</a></p></li>
<li><p>that seemed to be where that code snippet was coming from, but the problem really originated a few lines above the call to cat: when the template for the 404 page (which is saved where the package was installed) is copied‚Äî<code>file_copy()</code> copies a file and <em>all of its permissions</em>‚Äîso the copy is read-only for non-admin users.</p></li>
<li><p>I opened a PR to test for the error, then applied a fix to prevent it from being thrown again.</p></li>
<li><p>Asked the reporter to install the patch on their system and report back on whether it worked.</p></li>
<li><p>They reported back that it did‚Äîand pointed out a typo!</p></li>
<li><p>After merging PR, create a new release (see process in <a href="releases.html">The Release Workflow</a>)</p></li>
</ul>
</section>
</section>
</section>
<section id="multi-function-issues" class="level4" data-number="B.1.1.2">
<h4 data-number="B.1.1.2" class="anchored" data-anchor-id="multi-function-issues"><span class="header-section-number">B.1.1.2</span> Multi-Function Issues</h4>
</section>
<section id="test-failures-with-no-user-impact" class="level4" data-number="B.1.1.3">
<h4 data-number="B.1.1.3" class="anchored" data-anchor-id="test-failures-with-no-user-impact"><span class="header-section-number">B.1.1.3</span> Test Failures With No User Impact</h4>
</section>
</section>
<section id="sec-across" class="level3" data-number="B.1.2">
<h3 data-number="B.1.2" class="anchored" data-anchor-id="sec-across"><span class="header-section-number">B.1.2</span> Aross Packages</h3>
<p>Some features require manipulation across packages. Most often, this will mean a feature that is needed between {sandpaper} (user interface) and {varnish} (templates). To a rarer extent would you need features bewteen {sandpaper} and {pegboard}. You would almost never need a feature between {pegboard} and {varnish}.</p>
<section id="order-of-operations" class="level4" data-number="B.1.2.1">
<h4 data-number="B.1.2.1" class="anchored" data-anchor-id="order-of-operations"><span class="header-section-number">B.1.2.1</span> Order of Operations</h4>
<p>Features across packages require a bit of extra care because you are dealing with two moving targets. Remember that it‚Äôs not impossible to change features spanning packages in a backwards-compatible manner. If you are worried that something will break, I will remind you that not only do we have unit tests, but we also have <a href="https://github.com/carpentries/workbench-integration-test">The Workbench integration tests</a> that allows us to test development versions of The Workbench across a variety of lessons. On top of that, you have <a href="https://carpentries.github.io/sandpaper/reference/set_config.html#custom-engines">the ability to set the versions of The Workbench</a> used to build any given lesson. With these three tools, you should be able to address any issue that arises from a multi-package feature/issue.</p>
<p>This section talks about the order of operations in testing and release, which can be boiled down to these general rules:</p>
<ol type="1">
<li><strong>Always test {sandpaper} against the development version</strong> of the other package</li>
<li><strong>Release the dependent package first.</strong> Unless you have <a href="https://carpentries.github.io/varnish/news/index.html#varnish-100-2023-12-13">made breaking changes</a>, {varnish} and {pegboard} should be released <em>before</em> {sandpaper}.</li>
</ol>
<p>With that, here are scattered details of the order of operations for developing features for two packages.</p>
<p>Make sure to use the <code>Remotes</code> field in the {sandpaper} DESCRIPTION file to ensure that you are testing against the correct version of whatever other package you are using. That is, if you are testing <code>feature-a</code> in {sandpaper} and there is a companion <code>feature-a</code> branch in {varnish}, you want to specify <code>Remotes: carpentries/varnish@feature-a</code> in the <code>DESCRIPTION</code> file for {sandpaper}. This will not only allow the unit tests to work against the correct version of the dependent package, but it will also allow the integration tests and user tests to work.</p>
<p>In general, when you are creating a feature across two packages you will want to ensure the following:</p>
<ul class="task-list">
<li><label><input type="checkbox">there is an issue open in the workbench repository</label></li>
<li><label><input type="checkbox">the branch names for each feature are identical (or nearly so)</label></li>
<li><label><input type="checkbox">the pull request for {sandpaper} sets the <code>Remotes</code></label></li>
<li><label><input type="checkbox">the dependent package is released <em>before</em> sandpaper.</label></li>
</ul>
</section>
<section id="examples" class="level4" data-number="B.1.2.2">
<h4 data-number="B.1.2.2" class="anchored" data-anchor-id="examples"><span class="header-section-number">B.1.2.2</span> Examples</h4>
<section id="adding-doi-badge-for-peer-reviewed-lessons" class="level5 unnumbered">
<h5 class="unnumbered anchored" data-anchor-id="adding-doi-badge-for-peer-reviewed-lessons">Adding DOI badge for peer reviewed lessons</h5>
<p>Replace {pkg} with the first letter of the package the issue occurs in and {num} with the issue number</p>
<section id="s535v97-situation" class="level6 unnumbered">
<h6 class="unnumbered anchored" data-anchor-id="s535v97-situation">s535v97 Situation</h6>
<ul>
<li>Issue: <a href="https://github.com/carpentries/sandpaper/pull/525">carpentries/sandpaper#535</a>, <a href="https://github.com/carpentries/varnish/pull/97">carpentries/varnish#97</a></li>
<li>Resolver: tobyhodges, zkamvar</li>
<li>Type: Local</li>
<li>OS: NA</li>
<li>Package: {sandpaper}, {varnish}</li>
</ul>
</section>
<section id="s535v97-diagnosis" class="level6 unnumbered">
<h6 class="unnumbered anchored" data-anchor-id="s535v97-diagnosis">s535v97 Diagnosis</h6>
<p>In <a href="https://github.com/carpentries/workbench/issues/67">carpentries/workbench#67</a> and <a href="https://github.com/carpentries/varnish/issues/40">carpentries/varnish#40</a>, <a href="https://github.com/tobyhodges">Toby Hodges</a> had pointed out that while we had badges for lessons in pre-alpha, alpha, and beta phases of development, we did not yet have a badge for a published lesson with a DOI.</p>
<p>In the former infrastructure, we had indicated these statuses by adding a banner to the top of the lesson. This banner would take up extra room at the top of the lesson, so we changed it to a badge since we had room next to the logo. In this case, Toby was asking if we could add a <code>doi</code> key to the <code>config.yaml</code> that would allow the badge to be displayed on the website.</p>
</section>
<section id="s535v97-solution" class="level6 unnumbered">
<h6 class="unnumbered anchored" data-anchor-id="s535v97-solution">s535v97 Solution</h6>
<p>Toby had opened two pull requests on 2023-10-30:</p>
<ul>
<li><a href="https://github.com/carpentries/sandpaper/pull/535">carpentries/sandpaper#535</a> where he modified the <code>inst/templates/pkgdown-yaml-template.txt</code> and <code>create_pkgdown_yaml()</code> to include a <code>doi</code> element.</li>
<li><a href="https://github.com/carpentries/varnish/pull/97">carpentries/varnish#97</a> where he added HTML to the header that would insert a stylized DOI badge</li>
</ul>
<p>On 2023-11-10, Zhian Kamvar <a href="https://github.com/carpentries/sandpaper/pull/535/commits/a8579c78349522cb6fbd484c02d16325d1d34bcc">added a catch for full URL of a DOI vs the raw DOI itself</a> in {sandpaper} and determined that the contribution to {varnish} needed a couple of extra tweaks before being merged.</p>
<p>{varnish} was merged at 11:43AM and {sandpaper} was merged at 11:47AM</p>
</section>
<section id="s535v97-alternative-solution" class="level6 unnumbered">
<h6 class="unnumbered anchored" data-anchor-id="s535v97-alternative-solution">s535v97 Alternative Solution</h6>
<p>One of the tools that Toby had used was passing data through <code>create_pkgdown_yaml()</code>. It could have been done without that function and just passed through <code>initialize_metadata()</code> or something similar. For details on how data flows from {sandpaper} to {varnish}, read <a href="https://carpentries.github.io/sandpaper/articles/data-flow.html">Data Flow from Source to Website</a> in the {sandpaper} documentation.</p>
<p>It‚Äôs important to understand <em>why</em> Zhian used <code>create_pkgdown_yaml()</code> in the first place: to get {pkgdown} to recognise the <code>site/</code> folder as a package so he could hijack {pkgdown}‚Äôs machinery to provision a website. When he first started, he did not realize that he could pass any number of data elements directly to the {varnish} templates (as is done through the global variable caches), so everything was written to <code>site/_pkgdown.yaml</code>. This was cumbersome because it involves the IO for the pkgdown template file, the config file, and the resulting pkgdown yaml. It was much easier to load the config file via <code>initialize_metadata()</code> and use that to carry the configuration items.</p>
</section>
</section>
</section>
</section>
</section>
<section id="sec-upstream" class="level2" data-number="B.2">
<h2 data-number="B.2" class="anchored" data-anchor-id="sec-upstream"><span class="header-section-number">B.2</span> Upstream R Packages</h2>
<section id="sec-renv" class="level3" data-number="B.2.1">
<h3 data-number="B.2.1" class="anchored" data-anchor-id="sec-renv"><span class="header-section-number">B.2.1</span> renv</h3>
<section id="background" class="level4" data-number="B.2.1.1">
<h4 data-number="B.2.1.1" class="anchored" data-anchor-id="background"><span class="header-section-number">B.2.1.1</span> Background</h4>
<p>The {renv} package is a key player for allowing {sandpaper} to provision and maintain the R packages required to build R-based lessons. The motivation and strategy for how it works can be found in the <a href="https://carpentries.github.io/sandpaper/articles/building-with-renv.html">Building Lessons With A Package Cache</a> article in the {sandpaper} docuementation.</p>
<p>It‚Äôs worth diving into <a href="https://github.com/carpentries/sandpaper/issues/21">carpentries/sandpaper#21</a> to see the discussion and thoughts around the origin of the design for using this feature. It was implemented during a three week period between 2021-08-24 and 2021-09-16, as detailed in the pull request <a href="https://github.com/carpentries/sandpaper/pull/158">carpentries/sandpaper#158</a>.</p>
</section>
<section id="in-practices" class="level4" data-number="B.2.1.2">
<h4 data-number="B.2.1.2" class="anchored" data-anchor-id="in-practices"><span class="header-section-number">B.2.1.2</span> In practices</h4>
<p>We have to consider {renv} in practice from the standpoint of both local computers and on GitHub, which can behave very differently and require different tools to address their tasks.</p>
<p>There are three tools and packages that use {renv}:</p>
<ol type="1">
<li>{sandpaper} is designed to provide a way to manage dependencies in a lesson</li>
<li><a href="https://carpentries.github.io/vise">{vise}</a> was originally intended as a project to split out {sandpaper} code that used {renv} to simplify the testing. At the moment, it provides utilities for automatically provisioning C libraries on Ubunutu Linux and running the equivalent of <code>sandpaper::update_cache()</code> in a GitHub Actions context.</li>
<li><a href="https://github.com/carpentries/actions">carpentries/actions</a> these contain R code within YAML files üò± that will call {renv} and {vise}.</li>
</ol>
</section>
<section id="debugging-tips" class="level4" data-number="B.2.1.3">
<h4 data-number="B.2.1.3" class="anchored" data-anchor-id="debugging-tips"><span class="header-section-number">B.2.1.3</span> Debugging Tips</h4>
<section id="setting-up-a-reproducible-environment" class="level5" data-number="B.2.1.3.1">
<h5 data-number="B.2.1.3.1" class="anchored" data-anchor-id="setting-up-a-reproducible-environment"><span class="header-section-number">B.2.1.3.1</span> Setting up a reproducible environment</h5>
<p>Browse the <a href="https://github.com/rstudio/renv/issues?q=is%3Aissue+author%3Azkamvar+is%3Aclosed+sort%3Acreated-asc">{renv} issues opened by @zkamvar</a>. In nearly all of these issues, I provide a reproducible example. They generally follow the pattern of:</p>
<ol type="1">
<li>create a temporary file</li>
<li>make it a directory and move there</li>
<li>add any files that are needed <em>before</em> the renv project is set up (if specific to problem)</li>
<li>set up a {renv} project with <code>renv::init()</code></li>
<li>demonstrate problem</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(tmp)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(tmp)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="st">"library(R6)"</span>, <span class="st">"test.R"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">init</span>(<span class="at">profile =</span> <span class="st">"test"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># demonstrate problem here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="choosing-a-minimal-example" class="level5" data-number="B.2.1.3.2">
<h5 data-number="B.2.1.3.2" class="anchored" data-anchor-id="choosing-a-minimal-example"><span class="header-section-number">B.2.1.3.2</span> Choosing a minimal example</h5>
<p>Presenting a failing CI run with a Workbench lesson <em>is</em> reproducible, but it‚Äôs not minimal. Presenting the same with a smaller lesson is still not minimal. Often times, the issue involves detecting and installing a new package. In this case, you want to choose a package that has few to no dependencies and <em>is not listed as a dependency for knitr</em>. One example that I use often is the <a href="https://cran.r-project.org/package=cowsay">{cowsay}</a> package. It has a total of three dependencies and is not depended on by anything. If I need a quick package with zero dependencies, I will reach for <a href="https://r6.r-lib.org">{R6}</a> or <a href="https://cran.r-project.org/package=aweek">{aweek}</a>. Both of these packages are under 100 Kilobytes, are pure R code, do not have any dependencies, and do not require compillation.</p>
</section>
<section id="when-you-just-cant-reproduce-it-locally" class="level5" data-number="B.2.1.3.3">
<h5 data-number="B.2.1.3.3" class="anchored" data-anchor-id="when-you-just-cant-reproduce-it-locally"><span class="header-section-number">B.2.1.3.3</span> When you just can‚Äôt reproduce it locally</h5>
<p>There have been times when {renv} seems to fail <em>only</em> on GitHub Actions. This was the case for {renv} version 0.17.0, as I reported in <a href="https://github.com/rstudio/renv/issues/1161">rstudio/renv#1161</a>.</p>
<p>The important thing in these situations is to stay calm and try to narrow down as much as possible the exact conditions that will create the problem. Once you have those, you can open an issue on the {renv} issue tracker. If you are at this point, it‚Äôs important to not expect this to be resolved quickly, because it is likely out of your control. The best you can do is to try the debugging techniques that Kevin provides and report back on the issue thread.</p>
<p>Once the issue is resolved: <strong>Thank Kevin for his help.</strong> This is a very important point. Maintainers often only hear from their users if somehting is going wrong, so it‚Äôs important to let them know that they are appreciated.</p>
</section>
</section>
</section>
</section>
<section id="sec-actions" class="level2" data-number="B.3">
<h2 data-number="B.3" class="anchored" data-anchor-id="sec-actions"><span class="header-section-number">B.3</span> GitHub Actions</h2>
<p>There is a category of issues that fail explicitly with GitHub actions only. As with the other issues, it is important not to panic when you encounter these, but instead, take stock of what happens when these happen. In general, here are the steps you should take to diagnosing problems:</p>
<ol start="0" type="1">
<li>Prepare your inbox to filter messages from GitHub. A good way is to check that the subject line matches ‚ÄúRun failed 01 Build and Deploy‚Äù or ‚ÄúRun failed 03 Update Cache‚Äù.</li>
<li>Find and read the error message from the log. You can find this by looking for the red X and expanding that section. It will normally scroll down to the error.</li>
<li>Read the <em>context</em> of the error message. Most errors happen because of problems upstream, so it‚Äôs important to see what was happening when that error happened</li>
<li>Restart the action. GitHub has a button near the top right of the action. If it‚Äôs ephemeral (e.g.&nbsp;networking error) then it will run fine on the next run.</li>
<li>Test the build locally</li>
<li>Test it on the <code>carpentries/sandpaper-docs</code> repository</li>
<li>Test it on a brand new repository created via the templates (<a href="https://bit.ly/new-lesson-md" class="uri">https://bit.ly/new-lesson-md</a> or <a href="https://bit.ly/new-lesson-rmd" class="uri">https://bit.ly/new-lesson-rmd</a>)</li>
</ol>
<p>Below I will attempt to outline common problem areas and their potential solutions. Note: this is not an exhaustive list, but you have to remember that in these situations, you are effectively debugging someone else‚Äôs computer, so patience is absolutely required because this is more difficult than plucking a single grain of rice with metal chopsticks.</p>
<section id="networking-failures" class="level3" data-number="B.3.1">
<h3 data-number="B.3.1" class="anchored" data-anchor-id="networking-failures"><span class="header-section-number">B.3.1</span> Networking Failures</h3>
<p>These are often the easiest problems to solve. You will encounter an error that says somthing like ‚Äúnetwork timed out‚Äù and it fails when either checking out the repository or installing pandoc. In these situations, you should check <a href="https://status.github.com" class="uri">https://status.github.com</a> to see if this is a problem with GitHub, and then you should restart the build. Most of the time, the build will work on the second try.</p>
</section>
<section id="upstream-system-dependency-issues" class="level3" data-number="B.3.2">
<h3 data-number="B.3.2" class="anchored" data-anchor-id="upstream-system-dependency-issues"><span class="header-section-number">B.3.2</span> Upstream System Dependency Issues</h3>
<section id="sec-bioc-intro109" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="sec-bioc-intro109">SSL error</h4>
<section id="bioc-intro109-situation" class="level5 unnumbered">
<h5 class="unnumbered anchored" data-anchor-id="bioc-intro109-situation">bioc-intro109 Situation</h5>
<ul>
<li>Issue: <a href="https://github.com/carpentries-incubator/bioc-intro/issues/109" class="uri">https://github.com/carpentries-incubator/bioc-intro/issues/109</a></li>
<li>Resolver: NA</li>
<li>Type: Remote</li>
<li>OS: Ubuntu 22.04</li>
<li>Package: NA</li>
</ul>
<p>On 2023-07-20, @lgatto, who maintains the carpentries-incubator/bioc-intro repository reported an error in their builds during the ‚ÄúSetup Package Cache‚Äù of the <code>sandpaper-main.yaml</code> workflow:</p>
<pre><code>Register Repositories
Using github PAT from envvar GITHUB_PAT
Error: Error: Failed to install 'vise' from GitHub:
  SSL peer certificate or SSH remote key was not OK: [api.github.com] SSL: no alternative certificate subject name matches target host name 'api.github.com'
Execution halted
Error: Process completed with exit code 1.</code></pre>
<p>This error was causing the <a href="https://carpentries.github.io/vise">carpentries/vise</a> package to not be installed and the {renv} package cache could not be provisioned for lessons. Because it involved the {renv} package cache, this was a problem that was limited to R-based lessons.</p>
</section>
<section id="bioc-intro109-diagnosis" class="level5 unnumbered">
<h5 class="unnumbered anchored" data-anchor-id="bioc-intro109-diagnosis">bioc-intro109 Diagnosis</h5>
<p>The cause of the problem was <a href="https://fosstodon.org/@gaborcsardi/110741646942210567">identified by Gabor Csardi</a> as a bug specific to the development version of <code>curl</code> on Ubuntu: <a href="https://bugs.launchpad.net/ubuntu/+source/curl/+bug/2028170" class="uri">https://bugs.launchpad.net/ubuntu/+source/curl/+bug/2028170</a>.</p>
<p>The key error message here was <code>SSL: no alternative certificate subject name matches target host name 'api.github.com'</code>. The <code>curl</code> program was checking the validity of the SSL certificate for <code>github.com</code>, but it was ignoring the rules for <code>*.github.com</code>, so when it found <code>api.github.com</code>, it saw that as an invalid site that should not be trusted.</p>
<p>Even though the default version of curl on GitHub‚Äôs runners is <em>not</em> the dev version, when we provision the workbench in the ‚ÄúSetup Lesson Engine‚Äù step, we query the system dependencies from the R-universe:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> curl https://carpentries.r-universe.dev/stats/sysdeps <span class="dv">2</span><span class="op">&gt;</span> /dev/null <span class="dt">\</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">|</span> <span class="ex">jq</span> <span class="at">-r</span> <span class="st">'.headers[0] | select(. != null)'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>libcurl4-openssl-dev
libfontconfig-dev
libfreetype-dev
libfribidi-dev
libharfbuzz-dev
libicu-dev
libgit2-dev
libjpeg-turbo8-dev
libpng-dev
libtiff-dev
libxml2-dev
libxslt1-dev
libssl-dev</code></pre>
<p>This installed the development version of curl into our system and introduced the bug during the ‚ÄúSetup Package Cache‚Äù step.</p>
</section>
<section id="bioc-intro109-solution" class="level5 unnumbered">
<h5 class="unnumbered anchored" data-anchor-id="bioc-intro109-solution">bioc-intro109 Solution</h5>
<p>The solution was to wait for a fix.</p>
</section>
<section id="bioc-intro109-alternative-solution" class="level5 unnumbered">
<h5 class="unnumbered anchored" data-anchor-id="bioc-intro109-alternative-solution">bioc-intro109 Alternative Solution</h5>
<p>An alternative solution that we tested was to switch the download method for R packages to ‚Äúwget‚Äù, but this was a non-starter because this caused the installation times for R packages <em>and</em> the workbench to rise because they would need to be compiled (posit PPM did not serve the binary packages over wget).</p>
</section>
<section id="bioc-intro109-narrative" class="level5 unnumbered">
<h5 class="unnumbered anchored" data-anchor-id="bioc-intro109-narrative">bioc-intro109 Narrative</h5>
<ul>
<li>I get the notification of the issue and @lgatto suspects it‚Äôs because of {vise}.</li>
<li>I install {vise} using <code>remotes::install_github("carpentries/vise")</code> to check that it‚Äôs installable and I am successful.</li>
<li>I rerun the action and get the same error. I run the action on the <a href="https://github.com/carpentries/sandpaper-docs/actions/runs/5600450591/job/15170692838">carpentries/sandpaper-docs</a> repository, but it also fails similarly. This confirms that it‚Äôs a broader issue.</li>
<li>I thought maybe also it was a problem in the {remotes} package since it hasn‚Äôt been updated on CRAN since 2021.</li>
<li>I found <a href="https://github.com/r-lib/remotes/issues/762" class="uri">https://github.com/r-lib/remotes/issues/762</a> which points to an issue in <code>utils::download.file()</code> as the source of the problems with curl.</li>
<li>I notice that {vise} is still recorded as ‚Äúzkamvar/vise‚Äù in the github actions files. I change it in <a href="https://github.com/carpentries/actions/commit/2de7e3fef36e242cb7b6dae348bfdb274b2791fd">carpentries/actions@2de7e3fef</a></li>
<li>This <a href="https://github.com/carpentries/sandpaper-docs/actions/runs/5600450591/job/15171251862">does not fix the issue</a> and I post to mastodon: <a href="https://fosstodon.org/@zkamvar/110741428815173845" class="uri">https://fosstodon.org/@zkamvar/110741428815173845</a></li>
<li>I update the installation for vise to use ‚Äúwget‚Äù as a fallback (see this <a href="https://github.com/carpentries/actions/compare/e9405d9b8f2f99a2a7fd16a31194fd8563af95c9..3fb4f689d3fed641e2644e11ce3b312edc991c70">comparison of commits</a></li>
<li>I create a new branch in carpentries/actions to set <code>options(download.file.method = "wget")</code> in setup-sandpaper (<a href="https://github.com/carpentries/actions/compare/2023-07-ssl-errors">view the diff</a>).</li>
<li>I create https://github.com/zkamvar/2023-07-19-test-actions, which <a href="https://github.com/zkamvar/2023-07-19-test-actions/actions/runs/5601090073/job/15172762540">fails initially</a> and replace all <code>@main</code> declarations in <code>.github/workflows/</code> with <code>@2023-07-ssl-errors</code> to test the fix that I created. The <a href="https://github.com/zkamvar/2023-07-19-test-actions/actions/runs/5601160026/job/15173081859">next run also fails</a> and it takes &gt; 17 minutes to set up the workbench (which normally takes ~1 minute or less). I understand that the ‚Äúwget‚Äù method will not work.</li>
<li><a href="https://fosstodon.org/@gaborcsardi/110741646942210567">Gabor Csardi identifies the issue as coming from the dev version of curl</a></li>
<li>I check the version of curl in <a href="https://github.com/actions/runner-images/blob/ubuntu22/20230710.1/images/linux/Ubuntu2204-Readme.md">the ubuntu runner image</a>, which I found by expanding ‚ÄúSetup Job‚Äù and then ‚ÄúRunner Image‚Äù in the GitHub action run and finding the URL above, but it is not devel.</li>
<li>I create <a href="https://github.com/zkamvar/test-github-actions-ssl" class="uri">https://github.com/zkamvar/test-github-actions-ssl</a> to as a MWE of the error.</li>
<li>I <a href="https://github.com/zkamvar/test-github-actions-ssl/commit/7b9bd2269c5c81ef7fe0658aaca2ef976cdeab8e">create a workflow that runs the command from the ubuntu bug report</a> and find that it works.</li>
<li>I <a href="https://github.com/zkamvar/test-github-actions-ssl/commit/ee637acccf45cbf41f5b60e963b72a07a28bcca7">update the workflow</a> so that it demonstrates the working example and then demonstrates the failing example. <a href="https://github.com/zkamvar/test-github-actions-ssl/actions/runs/5602298664/job/15176571806">It successfully fails</a></li>
<li>I wait and check the bug has been fixed for ubuntu and I rerun the workflow. <a href="https://github.com/zkamvar/test-github-actions-ssl/actions/runs/5602298664/job/15185938773">It succeeds</a> and I re-run the bioc-intro and sandpaper-docs builds to find that they work.</li>
</ul>
</section>
</section>
</section>
<section id="workflow-mis-configuration" class="level3" data-number="B.3.3">
<h3 data-number="B.3.3" class="anchored" data-anchor-id="workflow-mis-configuration"><span class="header-section-number">B.3.3</span> Workflow Mis-Configuration</h3>
<p>Sometimes the workflow files themselves are mis-configured. In these cases, the fix will involve updating the files in sandpaper‚Äôs <code>inst/workflows/</code> directory. If the <code>pr-comment.yaml</code> or <code>update-workflows.yaml</code> files are not affected, then a pull request will be created automatically to all lessons within a week after you submit the patch, but if these files are affected, then you will have to manually submit the patch.</p>
<section id="s399" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="s399">files with spaces in names cause <code>pr-comment.yaml</code> workflow to fail</h4>
<section id="s399-situation" class="level5 unnumbered">
<h5 class="unnumbered anchored" data-anchor-id="s399-situation">s399 Situation</h5>
<ul>
<li>Issue: <a href="https://github.com/carpentries/sandpaper/issues/399">carpentries/sandpaper#399</a></li>
<li>Resolver: zkamvar</li>
<li>Type: Remote</li>
<li>OS: Ubuntu 22.04</li>
<li>Package: sandpaper</li>
</ul>
</section>
<section id="s399-diagnosis" class="level5 unnumbered">
<h5 class="unnumbered anchored" data-anchor-id="s399-diagnosis">s399 Diagnosis</h5>
</section>
<section id="s399-solution" class="level5 unnumbered">
<h5 class="unnumbered anchored" data-anchor-id="s399-solution">s399 Solution</h5>
</section>
<section id="s399-alternative-solution" class="level5 unnumbered">
<h5 class="unnumbered anchored" data-anchor-id="s399-alternative-solution">s399 Alternative Solution</h5>
</section>
<section id="s399-narrative" class="level5 unnumbered">
<h5 class="unnumbered anchored" data-anchor-id="s399-narrative">s399 Narrative</h5>
</section>
</section>
</section>
<section id="permissions-changes" class="level3" data-number="B.3.4">
<h3 data-number="B.3.4" class="anchored" data-anchor-id="permissions-changes"><span class="header-section-number">B.3.4</span> Permissions Changes</h3>
<section id="carpentries-bot" class="level4" data-number="B.3.4.1">
<h4 data-number="B.3.4.1" class="anchored" data-anchor-id="carpentries-bot"><span class="header-section-number">B.3.4.1</span> carpentries-bot</h4>
</section>
</section>
<section id="actions" class="level3" data-number="B.3.5">
<h3 data-number="B.3.5" class="anchored" data-anchor-id="actions"><span class="header-section-number">B.3.5</span> Actions</h3>
</section>
</section>
<section id="sec-structural" class="level2" data-number="B.4">
<h2 data-number="B.4" class="anchored" data-anchor-id="sec-structural"><span class="header-section-number">B.4</span> Structural Features</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./sop.html" class="pagination-link" aria-label="Standard Operating Procedures">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Standard Operating Procedures</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>
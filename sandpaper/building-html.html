<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.532">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Learn how to build, debug, and contribute to the components that make up The Carpentries Workbench.">

<title>Workbench Developer’s Guide - 9&nbsp; Building HTML</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../pegboard/intro.html" rel="next">
<link href="../sandpaper/package-cache.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../guide.scss">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../sandpaper/intro.html">{sandpaper} User Interface</a></li><li class="breadcrumb-item"><a href="../sandpaper/building-html.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Building HTML</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Workbench Developer’s Guide</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/carpentries/workbench-dev/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">System Setup</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Testing The Workbench</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Design Considerations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Flow Diagrams</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../features.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Adding Features</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">{sandpaper} User Interface</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sandpaper/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The {sandpaper} package</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sandpaper/testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Testing {sandpaper}</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sandpaper/package-cache.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">The R package cache</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sandpaper/building-html.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Building HTML</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">{pegboard} Validation and Parsing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pegboard/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The {pegboard} package</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">{varnish} Web Styling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../varnish/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">The {varnish} package</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Package Distribution</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../releases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Release Process for Workbench Packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hotfixes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Releasing Hotfixes</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Remote Deployment and Management</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../remote/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../remote/deploy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Deployment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../remote/pull-request.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Pull Request Responders</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Standard Operating Procedures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../flight-rules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Examples and Flight Rules</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">9.1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#page-types-in-the-workbench" id="toc-page-types-in-the-workbench" class="nav-link" data-scroll-target="#page-types-in-the-workbench"><span class="header-section-number">9.1.1</span> Page types in The Workbench</a></li>
  </ul></li>
  <li><a href="#rendering-html" id="toc-rendering-html" class="nav-link" data-scroll-target="#rendering-html"><span class="header-section-number">9.2</span> Rendering HTML</a>
  <ul class="collapse">
  <li><a href="#working-with-the-output" id="toc-working-with-the-output" class="nav-link" data-scroll-target="#working-with-the-output"><span class="header-section-number">9.2.1</span> Working with the Output</a></li>
  </ul></li>
  <li><a href="#post-processing-with-xpath" id="toc-post-processing-with-xpath" class="nav-link" data-scroll-target="#post-processing-with-xpath"><span class="header-section-number">9.3</span> Post-processing with XPath</a>
  <ul class="collapse">
  <li><a href="#translate_overview" id="toc-translate_overview" class="nav-link" data-scroll-target="#translate_overview"><span class="header-section-number">9.3.1</span> <code>translate_overview()</code></a></li>
  <li><a href="#fix_headings" id="toc-fix_headings" class="nav-link" data-scroll-target="#fix_headings"><span class="header-section-number">9.3.2</span> <code>fix_headings()</code></a></li>
  <li><a href="#fix_accordions" id="toc-fix_accordions" class="nav-link" data-scroll-target="#fix_accordions"><span class="header-section-number">9.3.3</span> <code>fix_accordions()</code></a></li>
  <li><a href="#fix_callouts" id="toc-fix_callouts" class="nav-link" data-scroll-target="#fix_callouts"><span class="header-section-number">9.3.4</span> <code>fix_callouts()</code></a></li>
  <li><a href="#fix_codeblocks" id="toc-fix_codeblocks" class="nav-link" data-scroll-target="#fix_codeblocks"><span class="header-section-number">9.3.5</span> <code>fix_codeblocks()</code></a></li>
  <li><a href="#fix_figures" id="toc-fix_figures" class="nav-link" data-scroll-target="#fix_figures"><span class="header-section-number">9.3.6</span> <code>fix_figures()</code></a></li>
  <li><a href="#fix_setup_link" id="toc-fix_setup_link" class="nav-link" data-scroll-target="#fix_setup_link"><span class="header-section-number">9.3.7</span> <code>fix_setup_link()</code></a></li>
  </ul></li>
  <li><a href="#applying-varnish-templating-with-pkgdownrender_page" id="toc-applying-varnish-templating-with-pkgdownrender_page" class="nav-link" data-scroll-target="#applying-varnish-templating-with-pkgdownrender_page"><span class="header-section-number">9.4</span> Applying {varnish} templating with <code>pkgdown::render_page()</code></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../sandpaper/intro.html">{sandpaper} User Interface</a></li><li class="breadcrumb-item"><a href="../sandpaper/building-html.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Building HTML</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Building HTML</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">9.1</span> Introduction</h2>
<p>Building HTML in The Workbench is a process that is isolated from rendering R <em>Markdown</em> to <em>Markdown</em>. There are three general steps to building the HTML files:</p>
<ol type="1">
<li><strong>render</strong> the HTML using <code>pandoc</code> with our custom lua filters (which transform our special fenced-divs and flattens relative links)</li>
<li><strong>post-process</strong> the HTML using {xml2} to further refine and translate elements that we cannot achieve through Lua filters. It is here that we do things like adding heading anchors, removing instructor notes for learner view, etc.</li>
<li><strong>apply {varnish} templates</strong> by passing <a href="https://carpentries.github.io/sandpaper/dev/articles/data-flow.html">global variables</a> and HTML to {pkgdown}. This is where the metadata and most of the translations are applied.</li>
</ol>
<section id="page-types-in-the-workbench" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1" class="anchored" data-anchor-id="page-types-in-the-workbench"><span class="header-section-number">9.1.1</span> Page types in The Workbench</h3>
<p>There are generally three kinds of pages that occur in The Workbench: single content pages where the HTML is directly generated from the Markdown, combined pages where two or more Markdown files contribute to the page content, and aggregate pages where the HTML is collected from specific sections of the single content pages after they have been rendered.</p>
<section id="single-content-pages" class="level4" data-number="9.1.1.1">
<h4 data-number="9.1.1.1" class="anchored" data-anchor-id="single-content-pages"><span class="header-section-number">9.1.1.1</span> Single Content Pages</h4>
<p>These pages are generated directly from Markdown content and are going to be in the <code>episodes/</code>, <code>instructors/</code>, and <code>learners/</code> folders. There are special exceptions that are used for combined pages and aggregate pages.</p>
</section>
<section id="combined-pages" class="level4" data-number="9.1.1.2">
<h4 data-number="9.1.1.2" class="anchored" data-anchor-id="combined-pages"><span class="header-section-number">9.1.1.2</span> Combined Pages</h4>
<p>Combined pages are rendered to HTML and then concatenated together.</p>
<section id="index.md-and-learnerssetup.md" class="level5" data-number="9.1.1.2.1">
<h5 data-number="9.1.1.2.1" class="anchored" data-anchor-id="index.md-and-learnerssetup.md"><span class="header-section-number">9.1.1.2.1</span> <code>index.md</code> and <code>learners/setup.md</code></h5>
<p>These form <code>/index.html</code> aka the home page where the sidebar shows the sections of the setup document.</p>
<table class="table">
<thead>
<tr class="header">
<th>source</th>
<th>section</th>
<th>anchor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>index.md</code></td>
<td>index</td>
<td><code>#</code></td>
</tr>
<tr class="even">
<td><code>learners/setup.md</code></td>
<td>setup</td>
<td><code>#setup</code></td>
</tr>
</tbody>
</table>
<p>The instructor view is similar, except it includes a schedule before the setup:</p>
<table class="table">
<thead>
<tr class="header">
<th>source</th>
<th>section</th>
<th>anchor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>index.md</code></td>
<td>index</td>
<td><code>#</code></td>
</tr>
<tr class="even">
<td><code>episodes/*</code></td>
<td>schedule</td>
<td><code>#schedule</code></td>
</tr>
<tr class="odd">
<td><code>learners/setup.md</code></td>
<td>setup</td>
<td><code>#setup</code></td>
</tr>
</tbody>
</table>
</section>
<section id="profiles" class="level5" data-number="9.1.1.2.2">
<h5 data-number="9.1.1.2.2" class="anchored" data-anchor-id="profiles"><span class="header-section-number">9.1.1.2.2</span> <code>profiles/*</code></h5>
<p>All the profiles pages are concatenated into a single page called <code>/profiles.html</code>.</p>
</section>
<section id="instructorsinstructor-notes.md-and-episodes" class="level5" data-number="9.1.1.2.3">
<h5 data-number="9.1.1.2.3" class="anchored" data-anchor-id="instructorsinstructor-notes.md-and-episodes"><span class="header-section-number">9.1.1.2.3</span> <code>instructors/instructor-notes.md</code> and <code>episodes/*</code></h5>
<p>The instructor notes (global and inline) are in a page called <code>/instructor/instructor-notes.html</code> The instructor notes are a special kind of combination that adds the in-line instructor notes to the end of the <code>instructor-notes.md</code> file. The in-line instructor notes start at the section with the anchor <code>#aggregate-instructor-notes</code> with subsections that have the anchor of the episode filenames.</p>
</section>
</section>
<section id="aggregate-pages" class="level4" data-number="9.1.1.3">
<h4 data-number="9.1.1.3" class="anchored" data-anchor-id="aggregate-pages"><span class="header-section-number">9.1.1.3</span> Aggregate Pages</h4>
<section id="all-in-one-page" class="level5" data-number="9.1.1.3.1">
<h5 data-number="9.1.1.3.1" class="anchored" data-anchor-id="all-in-one-page"><span class="header-section-number">9.1.1.3.1</span> All in one page</h5>
<p>This is at <code>/aio.html</code> and is a concatenation of the schedule. Each episode will be in a section with the ID <code>aio-&lt;file-slug&gt;</code>. An episode file named <code>introduction.md</code> will have the address <code>/aio.html#aio-introduction</code> in the aio page. Note: the aio prefix is to prevent a clash with the ID.</p>
</section>
<section id="keypoints" class="level5" data-number="9.1.1.3.2">
<h5 data-number="9.1.1.3.2" class="anchored" data-anchor-id="keypoints"><span class="header-section-number">9.1.1.3.2</span> Keypoints</h5>
<p>This is at <code>/key-points.html</code>. The key points of each episode is extracted and placed into sections with the ID of <code>&lt;file-slug&gt;</code>. An episode file name <code>introduction.md</code> will have the address <code>/key-points.html#introduction</code>.</p>
</section>
<section id="images" class="level5" data-number="9.1.1.3.3">
<h5 data-number="9.1.1.3.3" class="anchored" data-anchor-id="images"><span class="header-section-number">9.1.1.3.3</span> Images</h5>
<p>This is at <code>/instructor/images.html</code> and contains a concatenation of all the images in the lesson, printing the alt-text for each image if it exists.</p>
</section>
</section>
</section>
</section>
<section id="rendering-html" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="rendering-html"><span class="header-section-number">9.2</span> Rendering HTML</h2>
<p>The first step of the pipeline is to render the HTML from <em>Markdown</em> (in the <code>site/built</code> folder) using pandoc with our custom lua filters. This is entirely encapsulated within the function <a href="https://carpentries.github.io/sandpaper/reference/render_html.html"><code>render_html()</code></a>:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TB
    IN["site/built/FILE.md"]
    TMP["/tmp/tempfile.html"]
    OUT[/"R Object"\]
    pandoc{{"pandoc"}}
    LUA["sandpaper/../lesson.lua"]

    IN --&gt; pandoc --&gt; TMP
    TMP --&gt;|"readLines()"| OUT
    LUA --&gt;|"construct_pandoc_args()"| pandoc
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p><code>render_html()</code> is called by all of the pages which <strong>need to render content from markdown</strong>:</p>
<div class="img-fluid quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="render-html.png" class="img-fluid figure-img" alt="call tree leading to render_html showing that all function calls originate from build_site"></p>
<figcaption><code>render_html()</code> generates HTML from Markdown files</figcaption>
</figure>
</div>
<p>The HTML that is rendered from <code>render_html()</code> is not standalone and expected to be insert into the <code>&lt;main&gt;</code> tags of <a href="https://jerryjones.dev/2018/01/30/basic-html-boilerplate-structure/">HTML boilderplate</a>. Luckily, <code>render_html()</code> <em>is</em> a standalone function. This means that you do not need to prepare anything other than a document for it to render. Here’s an example rendering basic <em>Markdown</em> to HTML as a character string. Let’s say we had a single markdown document that just showed:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>I can write in **Markdown** and $<span class="sc">\\</span>LaTeX$ :joy_cat:</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When rendered, it would look like this:</p>
<blockquote class="blockquote">
<p>I can write in <strong>Markdown</strong> and <span class="math inline">\(\\LaTeX\)</span> <span class="emoji" data-emoji="joy_cat">😹</span></p>
</blockquote>
<p>To test the rendering, we can create a temporary file on the fly and use <code>render_html()</code> to render it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="st">"I can write in **Markdown** and $</span><span class="sc">\\</span><span class="st">LaTeX$ :joy_cat:"</span>, tmp)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>html_text <span class="ot">&lt;-</span> sandpaper<span class="sc">:::</span><span class="fu">render_html</span>(tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>html_text</code> variable contains a string of length 1 that contains the rendered HTML from the markdown.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>I can write in <span class="dt">&lt;</span><span class="kw">strong</span><span class="dt">&gt;</span>Markdown<span class="dt">&lt;/</span><span class="kw">strong</span><span class="dt">&gt;</span> and <span class="dt">&lt;</span><span class="kw">span</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ot">class</span><span class="op">=</span><span class="st">"math inline"</span><span class="dt">&gt;</span>\(\LaTeX\)<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span> <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"emoji"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ot">data-emoji</span><span class="op">=</span><span class="st">"joy_cat"</span><span class="dt">&gt;</span>😹<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="working-with-the-output" class="level3" data-number="9.2.1">
<h3 data-number="9.2.1" class="anchored" data-anchor-id="working-with-the-output"><span class="header-section-number">9.2.1</span> Working with the Output</h3>
<p>for all of the functions that use <code>render_html()</code> you will find this general pipeline: <code>file_path |&gt; render_html() |&gt; xml2::read_html()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>html_text <span class="ot">&lt;-</span> <span class="fu">render_html</span>(file_path)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (html_text <span class="sc">==</span> <span class="st">""</span>) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  html <span class="ot">&lt;-</span> xml2<span class="sc">::</span><span class="fu">read_html</span>(<span class="st">"&lt;p&gt;&lt;/p&gt;"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  html <span class="ot">&lt;-</span> xml2<span class="sc">::</span><span class="fu">read_html</span>(html_text)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can then use it to explore and manipulate the elements using good ol’ XPath synatax <span class="emoji" data-emoji="cowboy_hat_face">🤠</span> Yee haw!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="emoji" data-emoji="hand">✋</span> Wait just a rootin’ tootin’ minute!
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><span class="emoji" data-emoji="weary">😩</span> We have HTML, why are we using XML to parse it?</li>
<li><span class="emoji" data-emoji="cowboy_hat_face">🤠</span> Well, pardner, just like cowpolk can rustle up cows, sheep, goats, and even cats, XPath is a language that can be used to rustle up ANY sort of pointy-syntax markup like HTML, XML, SVG, and even <a href="https://en.wikipedia.org/wiki/Citation_Style_Language">CSL</a>.</li>
<li><span class="emoji" data-emoji="astonished">😲</span> That’s a good point!</li>
<li><span class="emoji" data-emoji="cowboy_hat_face">🤠</span> Fastest pun in the West!</li>
<li><span class="emoji" data-emoji="wink">😉</span></li>
</ul>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(html)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## {html_document}
## &lt;html&gt;
## [1] &lt;body&gt;&lt;p&gt;I can write in &lt;strong&gt;Markdown&lt;/strong&gt; and &lt;span class="math i ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>xml2<span class="sc">::</span><span class="fu">xml_find_all</span>(html, <span class="st">".//p/strong"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## {xml_nodeset (1)}
## [1] &lt;strong&gt;Markdown&lt;/strong&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>xml2<span class="sc">::</span><span class="fu">xml_find_all</span>(html, <span class="st">".//p/span[@class='emoji']"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## {xml_nodeset (1)}
## [1] &lt;span class="emoji" data-emoji="joy_cat"&gt;😹&lt;/span&gt;</code></pre>
</div>
</div>
<p>The HTML can also be <em>copied</em> by converting it to a character and re-reading it as XML (yes, this is legitimately the fastest way to do this).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>See <a href="https://carpentries.github.io/pegboard/articles/intro-xml.html#the-memory-of-xml-objects">the {pegboard} intro to XML about the memory of XML objects</a> for a reason <em>why</em> you want to copy XML documents this way.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>html2 <span class="ot">&lt;-</span> xml2<span class="sc">::</span><span class="fu">read_html</span>(<span class="fu">as.character</span>(html))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From here, the nodes get sent to <code>fix_nodes()</code> so that they can be post-processed.</p>
</section>
</section>
<section id="post-processing-with-xpath" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="post-processing-with-xpath"><span class="header-section-number">9.3</span> Post-processing with XPath</h2>
<p>Before the HTML can be passed to the template, it needs to be tweaked a bit. There are two reasons why we would need to tweak the HTML:</p>
<ul>
<li>We want to add a feature that is not supported in pandoc (or at least older versions)</li>
<li>We need to structurally rearrange pandoc defaults to match our template</li>
</ul>
<p>To do this, we read in the HTML with <code>xml2::read_html()</code> and then manipulate it using the sandpaper internal function <code>fix_nodes()</code>, which is called by the following functions:</p>
<div class="img-fluid quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fix-nodes-uses.png" class="img-fluid figure-img" alt="call tree leading to fix_nodes showing that all function calls originate from build_site"></p>
<figcaption><code>fix_nodes()</code> depends on <code>build_site()</code></figcaption>
</figure>
</div>
<p>In turn, <code>fix_nodes()</code> will call this cascade of XML manipulating functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sandpaper<span class="sc">:::</span>fix_nodes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (nodes = NULL) 
{
    if (length(nodes) == 0) 
        return(nodes)
    translate_overview(nodes)
    fix_headings(nodes)
    fix_accordions(nodes)
    fix_callouts(nodes)
    fix_codeblocks(nodes)
    fix_figures(nodes)
    fix_setup_link(nodes)
}
&lt;bytecode: 0x5639adb73698&gt;
&lt;environment: namespace:sandpaper&gt;</code></pre>
</div>
</div>
<div class="img-fluid quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fix-nodes-deps.png" class="img-fluid figure-img" alt="graph showing three levels of dependencies for fix_nodes(). The second level functions generally start with get and add. The third level functions are translation functions."></p>
<figcaption>Call tree for <code>fix_nodes()</code></figcaption>
</figure>
</div>
<p>I will show the effects of each of these functions one by one, but first, here’s a couple of functions that will help me demonstrate so I don’t have to keep retyping an copying/pasting:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>render_and_parse <span class="ot">&lt;-</span> <span class="cf">function</span>(txt) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">writeLines</span>(txt, tmp)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(xml2<span class="sc">::</span><span class="fu">read_html</span>(sandpaper<span class="sc">:::</span><span class="fu">render_html</span>(tmp)))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>print_html <span class="ot">&lt;-</span> <span class="cf">function</span>(html, <span class="at">xpath =</span> <span class="st">".//body/*"</span>) {</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">writeLines</span>(<span class="fu">as.character</span>(xml2<span class="sc">::</span><span class="fu">xml_find_all</span>(html, xpath)))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="translate_overview" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1" class="anchored" data-anchor-id="translate_overview"><span class="header-section-number">9.3.1</span> <code>translate_overview()</code></h3>
<p>The Overview card is produced by the Lua filter, combining the <code>objectives</code> and <code>questions</code> fenced divs into one entity:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ovr <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="st">::: objectives</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="st">- one</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="st">::: questions</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="st">- one?</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="st">:::"</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">render_and_parse</span>(ovr) <span class="sc">|&gt;</span> </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;div class="overview card"&gt;
&lt;h2 class="card-header"&gt;Overview&lt;/h2&gt;
&lt;div class="row g-0"&gt;
&lt;div class="col-md-4"&gt;
&lt;div class="card-body"&gt;
&lt;div class="inner"&gt;
&lt;h3 class="card-title"&gt;Questions&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;one?&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="col-md-8"&gt;
&lt;div class="card-body"&gt;
&lt;div class="inner bordered"&gt;
&lt;h3 class="card-title"&gt;Objectives&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;one&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<p>The <em>only</em> purpose for <code>translate_overview()</code> is to translate the entities for this card into different languages, so if we use it in an English context, nothing happens, but if we use it in a <em>Japanese</em> context, the the translation appears:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_language</span>(<span class="st">"ja"</span>, {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render_and_parse</span>(ovr) <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    sandpaper<span class="sc">:::</span><span class="fu">translate_overview</span>() <span class="sc">|&gt;</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print_html</span>()</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;div class="overview card"&gt;
&lt;h2 class="card-header"&gt;Overview&lt;/h2&gt;
&lt;div class="row g-0"&gt;
&lt;div class="col-md-4"&gt;
&lt;div class="card-body"&gt;
&lt;div class="inner"&gt;
&lt;h3 class="card-title"&gt;Questions&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;one?&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="col-md-8"&gt;
&lt;div class="card-body"&gt;
&lt;div class="inner bordered"&gt;
&lt;h3 class="card-title"&gt;Objectives&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;one&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
</section>
<section id="fix_headings" class="level3" data-number="9.3.2">
<h3 data-number="9.3.2" class="anchored" data-anchor-id="fix_headings"><span class="header-section-number">9.3.2</span> <code>fix_headings()</code></h3>
<p>Headings in The Workbench need a couple of things done:</p>
<ol start="0" type="1">
<li>The parent div needs to be a <code>&lt;section&gt;</code> tag</li>
<li>They need <a href="https://amberwilson.co.uk/blog/are-your-anchor-links-accessible/">anchor links</a> added to the headings (we took ours from {pkdown})</li>
<li>The section element needed to be a <code>section-heading</code> class and there needed to be an <code>&lt;hr&gt;</code> element underneath the <code>&lt;h2&gt;</code> tags.</li>
</ol>
<p>Behold!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>heads <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="st">## Heading 2 {#i-am-a-section-link}</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="st">### Heading 3 </span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="st">This is in a section, but it's not a section</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="st">## Heading 2</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="st">This is a new section</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">render_and_parse</span>(heads) <span class="sc">|&gt;</span> <span class="fu">print_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;div id="i-am-a-section-link" class="section level2"&gt;
&lt;h2&gt;Heading 2&lt;/h2&gt;
&lt;div id="heading-3" class="section level3"&gt;
&lt;h3&gt;Heading 3&lt;/h3&gt;
&lt;p&gt;This is in a section, but it’s not a section&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="heading-2" class="section level2"&gt;
&lt;h2&gt;Heading 2&lt;/h2&gt;
&lt;p&gt;This is a new section&lt;/p&gt;
&lt;/div&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">render_and_parse</span>(heads) <span class="sc">|&gt;</span> sandpaper<span class="sc">:::</span><span class="fu">fix_headings</span>() <span class="sc">|&gt;</span> <span class="fu">print_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;section id="i-am-a-section-link"&gt;
&lt;h2 class="section-heading"&gt;Heading 2&lt;a class="anchor" aria-label="anchor" href="#i-am-a-section-link"&gt;&lt;/a&gt;
&lt;/h2&gt;
&lt;hr class="half-width"&gt;
&lt;div id="heading-3" class="section level3"&gt;
&lt;h3&gt;Heading 3&lt;/h3&gt;
&lt;p&gt;This is in a section, but it’s not a section&lt;/p&gt;
&lt;/div&gt;
&lt;/section&gt;
&lt;section id="heading-2"&gt;
&lt;h2 class="section-heading"&gt;Heading 2&lt;a class="anchor" aria-label="anchor" href="#heading-2"&gt;&lt;/a&gt;
&lt;/h2&gt;
&lt;hr class="half-width"&gt;
&lt;p&gt;This is a new section&lt;/p&gt;
&lt;/section&gt;</code></pre>
</div>
</div>
</section>
<section id="fix_accordions" class="level3" data-number="9.3.3">
<h3 data-number="9.3.3" class="anchored" data-anchor-id="fix_accordions"><span class="header-section-number">9.3.3</span> <code>fix_accordions()</code></h3>
<p>The only thing that happens with accordions is that they get translated:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>accord <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="st">::: instructor</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="st">drink water</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">render_and_parse</span>(accord) <span class="sc">|&gt;</span> <span class="fu">print_html</span>(<span class="st">".//h3/text()"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  

  Instructor Note
  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_language</span>(<span class="st">"ja"</span>, {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render_and_parse</span>(accord) <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    sandpaper<span class="sc">:::</span><span class="fu">fix_accordions</span>() <span class="sc">|&gt;</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print_html</span>(<span class="st">".//h3/text()"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Instructor Note</code></pre>
</div>
</div>
</section>
<section id="fix_callouts" class="level3" data-number="9.3.4">
<h3 data-number="9.3.4" class="anchored" data-anchor-id="fix_callouts"><span class="header-section-number">9.3.4</span> <code>fix_callouts()</code></h3>
<p>Callouts need to have translations applied and ids adjusted:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>keyps <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="st">::: keypoints</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="st"> - hydrate</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="st">:::"</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">render_and_parse</span>(keyps) <span class="sc">|&gt;</span> <span class="fu">print_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;div id="keypoints1" class="callout keypoints"&gt;
&lt;div class="callout-square"&gt;
&lt;i class="callout-icon" data-feather="key"&gt;&lt;/i&gt;
&lt;/div&gt;
&lt;div class="section level3 callout-title callout-inner"&gt;
&lt;h3 class="callout-title"&gt;Keypoints&lt;/h3&gt;
&lt;div class="callout-content"&gt;
&lt;ul&gt;
&lt;li&gt;hydrate&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">render_and_parse</span>(keyps) <span class="sc">|&gt;</span> sandpaper<span class="sc">:::</span><span class="fu">fix_callouts</span>() <span class="sc">|&gt;</span> <span class="fu">print_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;div id="keypoints1" class="callout keypoints"&gt;
&lt;div class="callout-square"&gt;
&lt;i class="callout-icon" data-feather="key"&gt;&lt;/i&gt;
&lt;/div&gt;
&lt;div class="callout-inner"&gt;
&lt;h3 class="callout-title"&gt;Key Points&lt;a class="anchor" aria-label="anchor" href="#keypoints1"&gt;&lt;/a&gt;
&lt;/h3&gt;
&lt;div class="callout-content"&gt;
&lt;ul&gt;
&lt;li&gt;hydrate&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<p>The translations are also applied:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_language</span>(<span class="st">"ja"</span>, {</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render_and_parse</span>(keyps) <span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    sandpaper<span class="sc">:::</span><span class="fu">fix_callouts</span>() <span class="sc">|&gt;</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print_html</span>(<span class="st">".//h3/text()"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key Points</code></pre>
</div>
</div>
</section>
<section id="fix_codeblocks" class="level3" data-number="9.3.5">
<h3 data-number="9.3.5" class="anchored" data-anchor-id="fix_codeblocks"><span class="header-section-number">9.3.5</span> <code>fix_codeblocks()</code></h3>
<p>Codeblocks have a phantom H3 attached</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>codes <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="st">```r</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="st">cat('mouse')</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="st">```"</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">render_and_parse</span>(codes) <span class="sc">|&gt;</span> <span class="fu">print_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;div class="sourceCode" id="cb1"&gt;&lt;pre class="sourceCode r"&gt;&lt;code class="sourceCode r"&gt;&lt;span id="cb1-1"&gt;&lt;a href="#cb1-1" aria-hidden="true" tabindex="-1"&gt;&lt;/a&gt;&lt;span class="fu"&gt;cat&lt;/span&gt;(&lt;span class="st"&gt;'mouse'&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">render_and_parse</span>(codes) <span class="sc">|&gt;</span> sandpaper<span class="sc">:::</span><span class="fu">fix_codeblocks</span>() <span class="sc">|&gt;</span> <span class="fu">print_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;div class="codewrapper sourceCode" id="cb1"&gt;
&lt;h3 class="code-label"&gt;R&lt;i aria-hidden="true" data-feather="chevron-left"&gt;&lt;/i&gt;&lt;i aria-hidden="true" data-feather="chevron-right"&gt;&lt;/i&gt;
&lt;/h3&gt;
&lt;pre class="sourceCode r" tabindex="0"&gt;&lt;code class="sourceCode r"&gt;&lt;span id="cb1-1"&gt;&lt;a href="#cb1-1" aria-hidden="true" tabindex="-1"&gt;&lt;/a&gt;&lt;span class="fu"&gt;cat&lt;/span&gt;(&lt;span class="st"&gt;'mouse'&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
</section>
<section id="fix_figures" class="level3" data-number="9.3.6">
<h3 data-number="9.3.6" class="anchored" data-anchor-id="fix_figures"><span class="header-section-number">9.3.6</span> <code>fix_figures()</code></h3>
<p>Figures need semantic HTML <code>&lt;figure&gt;</code>, not <code>&lt;div&gt;</code> and lone images with no captions should still be figures.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>figs <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="st">![](lone-img.png){alt='tumbleweed'}</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="st">![Just Sayin', Breakfast Plums, So Cold](papa-eating-plums.png){alt='an empty icebox, plums gone'}</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">render_and_parse</span>(figs) <span class="sc">|&gt;</span> <span class="fu">print_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;p&gt;&lt;img src="lone-img.png" alt="tumbleweed"&gt;&lt;/p&gt;
&lt;div class="figure"&gt;
&lt;img src="papa-eating-plums.png" alt="an empty icebox, plums gone"&gt;&lt;p class="caption"&gt;Just Sayin’, Breakfast Plums, So Cold&lt;/p&gt;
&lt;/div&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">render_and_parse</span>(figs) <span class="sc">|&gt;</span> sandpaper<span class="sc">:::</span><span class="fu">fix_figures</span>() <span class="sc">|&gt;</span> <span class="fu">print_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;figure&gt;&lt;img src="lone-img.png" alt="tumbleweed" class="figure mx-auto d-block"&gt;&lt;/figure&gt;
&lt;figure&gt;
&lt;img src="papa-eating-plums.png" alt="an empty icebox, plums gone" class="figure mx-auto d-block"&gt;&lt;figcaption&gt;Just Sayin’, Breakfast Plums, So Cold&lt;/figcaption&gt;
&lt;/figure&gt;</code></pre>
</div>
</div>
</section>
<section id="fix_setup_link" class="level3" data-number="9.3.7">
<h3 data-number="9.3.7" class="anchored" data-anchor-id="fix_setup_link"><span class="header-section-number">9.3.7</span> <code>fix_setup_link()</code></h3>
<p>When someone writes the link to <code>setup.html</code>, it needs to be transmogrified to be <code>index.html#setup</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>stp <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="st">[setup](../learners/setup.html) </span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="st">with [macOS](../learners/setup.html#macos)"</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">render_and_parse</span>(stp) <span class="sc">|&gt;</span> <span class="fu">print_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;p&gt;&lt;a href="setup.html"&gt;setup&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;with &lt;a href="setup.html#macos"&gt;macOS&lt;/a&gt;&lt;/p&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">render_and_parse</span>(stp) <span class="sc">|&gt;</span> sandpaper<span class="sc">:::</span><span class="fu">fix_setup_link</span>() <span class="sc">|&gt;</span> <span class="fu">print_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;p&gt;&lt;a href="index.html#setup"&gt;setup&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;with &lt;a href="index.html#macos"&gt;macOS&lt;/a&gt;&lt;/p&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="applying-varnish-templating-with-pkgdownrender_page" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="applying-varnish-templating-with-pkgdownrender_page"><span class="header-section-number">9.4</span> Applying {varnish} templating with <code>pkgdown::render_page()</code></h2>
<p>All HTML files get funneled into <code>pkgdown::render_page()</code> through <code>build_html()</code>, which in turn is ultimately called by <code>build_site()</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Want to change the HTML engine?
</div>
</div>
<div class="callout-body-container callout-body">
<p>If we were to change the templating engine (e.g.&nbsp;Quarto, Hugo, or (ugh) Jekyll<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>), <em>this is the place to change it</em>. Of course, it will not be ‘easy’, but it will be <em>possible</em>.</p>
</div>
</div>
<div class="img-fluid quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="render-page.png" class="img-fluid figure-img" alt="call tree leading to the pkgdown function render_page. This shows that build_html calls render_page and all functions that lead to build_html are ultimately called from build_site."></p>
<figcaption><code>pkgdown::render_page()</code> is the last stop from <code>build_site()</code></figcaption>
</figure>
</div>
<p>What you can see from the diagram, this function is the <em>last step</em> in the line to generate a website. As mentioned earlier, this will <a href="https://carpentries.github.io/sandpaper/dev/articles/data-flow.html#an-introduction-to-varnish"><strong>apply {varnish} templates</strong></a> to the HTML generated by <a href="#rendering-html"><code>render_html()</code></a> and modified by <a href="#post-processing-with-xpath"><code>fix_nodes()</code></a>. These templates contain mustache template variables that need to be filled in with variables passed through the <code>data</code> argument in <code>pkgdown::render_page()</code>. These variables are generated when <code>build_lesson()</code> is called and are derived from both the <code>config.yaml</code> and episode metadata. Thus, it is important to read the <a href="https://carpentries.github.io/sandpaper/articles/data-flow.html">Data Flow from Source to Website</a> vignette in {sandpaper} to understand how the flow works.</p>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Actually, one of the strengths of Jekyll is its ability to template websites by stitching together HTML. Just please, never expect anyone else to be able to render markdown with it or build from it locally.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../sandpaper/package-cache.html" class="pagination-link  aria-label=" &lt;span="" r="" package="" cache&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">The R package cache</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../pegboard/intro.html" class="pagination-link" aria-label="<span class='chapter-number'>10</span>&nbsp; <span class='chapter-title'>The {pegboard} package</span>">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The {pegboard} package</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>